# CSHARP
## 值类型和引用类型
**值类型**继承自System.ValueType，所有的值类型都是隐式密封的。值类型包括int、bool、float、char等基元类型以及结构体和枚举。内存一搬分配在栈上，赋值或者传参的时候会发生复制。我们也可以定义自己的struct，也会是值类型，但是这样的值类型的拷贝将会造成比内置类型更大的开销，应该谨慎对待。

**引用类型**：包括类、string、委托、数组和接口，内存一般分配在堆上，赋值或传参的时候只复制引用（地址）。

## 堆和栈
C#的内存分区基本只分为堆和栈
1）栈：栈是一片连续的内存域，由系统自动分配和维护，大小固定（默认1M，可配置）
内存分配效率高（速度快），栈顶元素使用完毕，立马释放。
2）堆：堆内存是无序的，内存大小动态分配（有上限）。所有的对象都从托管堆分配，CLR维护了一个NextObjPtr指针，指向下一个对象在堆中的分配位置。
当程序需要更多的堆空间时，由GC（垃圾回收机制）帮助我们清理内存。内存分配效率和速度都较低。

## 装箱和拆箱
1）装箱：将值类型转换为引用类型的过程。装箱时，首先在托管堆中分配内存；然后将值类型的字段复制到新分配的堆内存；最后返回对象引用。
频繁装箱可能会触发GC，造成卡顿（GC会将所有线程挂起）
2）拆箱：将引用类型转换为值类型的过程。拆箱时，先获取已装箱对象中各个字段的地址；然后将字段包含的值从堆内存复制到栈上。
装箱和拆箱都是比较耗时的操作，应尽量避免。
